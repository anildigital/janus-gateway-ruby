language: ruby

rvm:
  - 2.0.0
  - 1.9.3

before_install:
  - sudo add-apt-repository ppa:dns/gnu --yes
  - sudo apt-get update -qq
  - sudo apt-get install -y libmicrohttpd-dev libjansson-dev libnice-dev libssl-dev libsrtp-dev
  - sudo apt-get install -y libglib2.0-dev libini-config-dev libcollection-dev gengetopt
  - sudo apt-get install -y libtool autoconf automake make bison flex gcc cmake glib-2.0 clang
  - wget https://github.com/cisco/libsrtp/archive/v1.5.0.tar.gz
  - tar xfv v1.5.0.tar.gz
  - cd libsrtp-1.5.0
  - ./configure --prefix=/usr --enable-openssl --libdir=/usr/lib64
  - make libsrtp.so && sudo make uninstall && sudo make install
  - cd ..
  - git clone https://github.com/sctplab/usrsctp
  - cd usrsctp
  - ./bootstrap
  - ./configure --prefix=/usr
  - make && sudo make uninstall && sudo make install
  - cd ..
  - git clone git://git.libwebsockets.org/libwebsockets
  - cd libwebsockets
  - mkdir build
  - cd build
  - cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr ..
  - make && sudo make install
  - cd ..
  - git clone https://github.com/meetecho/janus-gateway.git
  - cd janus-gatewway
  - ./autogen.sh
  - ./configure --prefix=/opt/janus --disable-docs --disable-rabbitmq --enable-post-processing
  - make && sudo make install && make configs
  - cd ..
  - git clone https://github.com/cargomedia/janus-gateway-rtpbroadcast.git
  - cd janus-gateway-rtpbroadcast
  - ./autogen.sh
  - ./configure --prefix=/opt/janus
  - make && make install
  - mv /opt/janus/etc/janus/janus.plugin.cm.rtpbroadcast.cfg.sample /opt/janus/etc/janus/janus.plugin.cm.rtpbroadcast.cfg
  - /opt/janus/bin/janus &
